# Face Mask Editor

Face Mask Editorは、写真内の顔を自動的に検出し、絵文字で隠すことができるWebアプリケーションです。
ブラウザ上で動作し、自動検出されたマスクの位置やサイズ、角度を手動で微調整することも可能です。

## 機能

- **高精度な自動検出**: **OpenCV DNN (SSD)** を採用し、コラージュ写真や小さな顔でも安定して検出します。
- **インタラクティブな編集**:
    - **移動**: ドラッグ＆ドロップで位置調整
    - **リサイズ**: ハンドル操作でサイズ変更
    - **回転**: ハンドル操作で角度調整
    - **追加/削除**: 手動での追加や、誤検知の削除
- **使いやすさとプライバシー**:
    - **ファイル名の継承**: アップロードしたファイル名（例: `photo.png`）を引き継いで保存します（`photo_masked.jpg`）。
    - **軽量な保存**: 画質を保ちつつファイルサイズを抑えるために、最適化されたJPEG形式で出力します。
- **選べるマスク種類 (v2.0)**:
    - 従来の「絵文字 (☺️)」に加え、「白塗り (⬜)」と「黒塗り (⬛)」を選択可能になりました。
    - **自由なリサイズ**: 白塗り・黒塗りは縦横比を固定せず、自由な長方形に変形できます（絵文字は比率を維持）。
- **スマートな操作性 (v2.0)**:
    - 何も選択していない状態でボタンを押すと「次に追加する種類」を設定。
    - マスクを選択している状態でボタンを押すと「そのマスクの種類」を即座に変更。
- **高画質画像の完全対応 (v3.1)**:
    - **画質の維持**: リサイズなしで元の高画質な画像をそのまま保存・ダウンロードできます。
    - **正確な位置補正**: 4000px超の高解像度画像でも、AIが検出した位置にピタリとマスクを配置します。

## リリースノート

### v3.1 (2026-01-04)
- **高画質サポート**: 4K画像などで発生していたスタンプの位置ズレを完全に修正しました。
- **エディタ修正**: 大きな画像を読み込んだ際にエディタが表示されない問題を修正しました。

## 無料で公開 (Deployment)

このアプリは **[Vercel](https://vercel.com/)** (推奨) や Render などのプラットフォームで無料で公開できます。

### Vercelへのデプロイ (推奨: 爆速起動)
**「起動が遅いのが気になる」という場合はこちらがおすすめです。**
1. [Vercel](https://vercel.com/) にGitHubアカウントでログイン。
2. "Add New..." > "Project" を選択し、このリポジトリ (`face-mask`) をImport。
3. 設定はすべてデフォルトのままで "Deploy" をクリック。
   - ※ `vercel.json` が含まれているため、Python環境として自動認識されます。

### Renderへのデプロイ (代替案)
1. Renderで "Web Service" を新規作成し、GitHubリポジトリを連携。
2. Build Command: `pip install -r requirements.txt`
3. Start Command: `gunicorn app:app`
4. Plan: `Free` を選択。

## ローカルでの起動方法 (開発者向け)

1. リポジトリをクローンします。
2. 仮想環境を作成して有効化します:
   ```bash
   python -m venv venv
   source venv/bin/activate
   ```
3. 依存ライブラリをインストールします:
   ```bash
   pip install -r requirements.txt
   ```
4. サーバーを起動します:
   ```bash
   python app.py
   ```
5. ブラウザで [http://localhost:5001](http://localhost:5001) にアクセスします。

## 使い方

1. 画像をアップロードします。
2. **マスクの調整**:
   - マスクをクリックして選択し、移動・回転・リサイズします。
   - 上部のボタン `☺️` `⬜` `⬛` で種類を変更できます。
   - 選択時は「そのマスクの変更」、未選択時は「次に追加する設定」になります。
3. 「画像を保存」ボタンでダウンロードします。

