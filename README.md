# Face Mask Editor

Face Mask Editorは、写真内の顔を自動的に検出し、絵文字で隠すことができるWebアプリケーションです。
ブラウザ上で動作し、自動検出されたマスクの位置やサイズ、角度を手動で微調整することも可能です。

## 機能

- **高精度な自動検出**: **OpenCV DNN (SSD)** を採用し、コラージュ写真や小さな顔でも安定して検出します。
- **インタラクティブな編集**:
    - **移動**: ドラッグ＆ドロップで位置調整
    - **リサイズ**: ハンドル操作でサイズ変更
    - **回転**: ハンドル操作で角度調整
    - **追加/削除**: 手動での追加や、誤検知の削除
- **使いやすさとプライバシー**:
    - **ファイル名の継承**: アップロードしたファイル名（例: `photo.png`）を引き継いで保存します（`photo_masked.jpg`）。
    - **軽量な保存**: 画質を保ちつつファイルサイズを抑えるために、最適化されたJPEG形式で出力します。
- **選べるマスク種類 (v2.0.0)**:
    - 従来の「絵文字 (☺️)」に加え、「白塗り (⬜)」と「黒塗り (⬛)」を選択可能になりました。
    - **自由なリサイズ**: 白塗り・黒塗りは縦横比を固定せず、自由な長方形に変形できます（絵文字は比率を維持）。
- **スマートな操作性 (v2.0.0)**:
    - 何も選択していない状態でボタンを押すと「次に追加する種類」を設定。
    - マスクを選択している状態でボタンを押すと「そのマスクの種類」を即座に変更。

## インストール方法

1. リポジトリをクローンします。
2. 仮想環境を作成して有効化します:
   ```bash
   python -m venv venv
   source venv/bin/activate
   ```
3. 依存ライブラリをインストールします:
   ```bash
   pip install -r requirements.txt
   ```

## 使い方

1. サーバーを起動します:
   ```bash
   python app.py
   ```
2. ブラウザで [http://localhost:5001](http://localhost:5001) にアクセスします。
3. 画像をアップロードします。
4. **マスクの調整**:
   - マスクをクリックして選択し、移動・回転・リサイズします。
   - 上部のボタン `☺️` `⬜` `⬛` で種類を変更できます。
   - 選択時は「そのマスクの変更」、未選択時は「次に追加する設定」になります。
5. 「画像を保存」ボタンでダウンロードします。

## リリースノート

### v2.0.0
- **マスク種類の追加**: 絵文字に加えて、プライバシー保護に便利な「白塗り」「黒塗り」を追加。
- **自由変形機能**: ボックスマスク（白/黒）は縦横比を維持せず、自由な形に変形可能に（絵文字は綺麗に見せるため比率固定）。
- **UI/UXの改善**:
    - 「選択して変更」と「設定して追加」を両立するスマートな選択ロジックを実装。
    - UI上で絵文字とボックスのグループを視覚的に分離。

### v1.1
- **検出精度の向上**: 内部解析解像度を上げ、小さな顔の検出漏れを防ぐように改修。
- **UXの改善**:
    - 絵文字サイズを顔の大きさにぴったり合うように調整 (1.0倍)。
    - ダウンロード時のファイル名が、元のファイル名を継承するように変更。
    - 保存フォーマットをJPEG (画質0.9) に変更し、ファイルサイズを大幅に削減。

### v1.0
- **エンジンの刷新**: 不安定だったMediaPipe検出器を廃止し、業界標準の OpenCV DNN (SSD) に変更。これにより検出の安定性が飛躍的に向上しました。
